" Plugins for GoLand:
" - Apache config
" - AsciiDoc
" - AWS Toolkit
" - Clojure-Kit
" - Dash
" - Deno
" - IdeaVim
" - Kubernetes
" - Live Edit
" - Native Debugging Support
" - Node.js
" - Prettier
" - Rust
" - Svelte
" - Terraform and HCL
" - TinyGo
" - Toml
" - Vue.js
" - WebAssembly
"
" Plugins for Android Studio:
" - Dart
" - Dash
" - Flutter
" - IdeaVim
" - Kotlin

set clipboard=unnamedplus
set history=2000
set hlsearch
set ignorecase
set incsearch
set iskeyword=@,48-57,192-255,#,_,-
set nrformats-=octal
set nonumber
set norelativenumber
set scrolloff=10
set showcmd
set showmode
set sidescroll=1
set sidescrolloff=6
set smartcase
set nostartofline
set undolevels=2000

" Nothing but onemore is currently supported (makes pasting annoying though),
" see https://youtrack.jetbrains.com/issue/VIM-956 for feature request.
set virtualedit=all

set ideajoin
set ideamarks
set idearefactormode=select
set ideastatusicon=gray
set ideavimsupport=
set ideawrite=all
"set ideastrictmode " Show IdeaVim errors.

sethandler n:vim i:vim x:vim v:vim

set argtextobj
set commentary
"set easymotion
"set exchange
set highlightedyank
set matchit
set multiple-cursors
set NERDTree
set ReplaceWithRegister
set sneak
set surround
set textobj-entire
set textobj-indent
set vim-paragraph-motion

let g:NERDTreeMapActivateNode = 'l'
let g:NERDTreeMapCloseDir     = 'h'

let g:highlightedyank_highlight_duration = "200"
let g:highlightedyank_highlight_color = "rgba(252, 232, 244, 155)"

" Custom keymappings .....................................................{{{1

let mapleader = "\<Space>"

nmap              <C-s> <Action>(SearchEverywhere)
nmap              <C-k> <Action>(QuickJavaDoc)
imap              <C-k> <Action>(ParameterInfo)
nmap              K     <Action>(ShowErrorDescription)
nmap              [e    <Action>(GotoPreviousError)
nmap              ]e    <Action>(GotoNextError)

" Leader
nmap              <leader><leader> <Action>(GotoFile)

" Buffers
nmap              <leader>bb  <Action>(RecentFiles)<Action>(SwitcherRecentEditedChangedToggleCheckBox)
nnoremap <silent> <leader>bn  :bnext<CR>
nnoremap <silent> <leader>bp  :bprevious<CR>
nmap              <leader>bs  :w<CR>

" Code
nmap              <leader>ca  <Action>(ShowIntentionActions)
nmap              <leader>cc  <Action>(Run)
nmap              <leader>cd  <Action>(GotoDeclaration)
nmap              <leader>cD  <Action>(GotoRelated)
nmap              <leader>cf  <Action>(ReformatCode)
nmap              <leader>ci  <Action>(GotoImplementation)
nmap              <leader>co  <Action>(OptimizeImports)
nmap              <leader>cr  <Action>(Refactorings.QuickListPopupAction)
nmap              <leader>ct  <Action>(GotoTypeDeclaration)
nmap              <leader>cu  <Action>(ShowUsages)
nmap              <leader>cx  <Action>(Cargo.RunExternalLinter)

nmap              <leader>cC  <Action>(ChooseRunConfiguration)
nmap              <leader>cI  <Action>(InspectCode)
nmap              <leader>cO  <Action>(CodeCleanup)

" Debugger
nmap              <F2>       <Action>(ToggleLineBreakpoint)
nmap              <D-F2>     <Action>(Stop)
nmap              <S-F2>     <Action>(ViewBreakpoints)
nmap              <F7>       <Action>(StepInto)
nmap              <F8>       <Action>(StepOver)
nmap              <D-F8>     <Action>(StepOut)
nmap              <F9>       <Action>(Resume)
nmap              <D-F9>     <Action>(Debug)
nmap              <S-F9>     <Action>(Pause)

" Files
nmap              <leader>fr  <Action>(RecentFiles)

" Git
nmap              <leader>gB  <Action>(Annotate)
nmap              <leader>gL  <Action>(LocalHistory.ShowHistory)

" Open
nmap              <leader>od  <Action>(Debug)
nmap              <leader>of  <Action>(NewElement)
nmap              <leader>op  :NERDTree<CR>
nmap              <leader>oP  :NERDTreeFind<CR>

" Project
nmap              <leader>pa  <Action>(OpenFile)
nmap              <leader>pp  <Action>(RecentProjectListGroup)
nmap              <leader>pt  <Action>(ActivateTODOToolWindow)
nmap              <leader>pT  <Action>(RerunTests)

" Search
nmap              <leader>sd  <Action>(FindInPath)
nmap              <leader>sD  <Action>(ReplaceInPath)
nmap              <leader>si  <Action>(GotoSymbol)
nmap              <leader>sj  <Action>(RecentLocations)
nmap              <leader>sk  <Action>(SmartSearchAction)

" Toggle
nmap              <leader>td  <Action>(CompareTwoFiles)
nnoremap          <leader>tl  :set number!<CR>
nnoremap          <leader>tL  :set relativenumber!<CR>
nnoremap          <leader>tw  :set wrap!<CR>

" Language Flutter
nmap              <leader>lfr  <Action>(Flutter.Toolbar.ReloadAction)
nmap              <leader>lfR  <Action>(Flutter.Toolbar.RestartAction)
nmap              <leader>lfa  <Action>(Dart.Restart.Analysis.Server)
nmap              <leader>lfc  <Action>(flutter.clean)
nmap              <leader>lfod <Action>(io.flutter.OpenDevToolsAction)
nmap              <leader>lfox <Action>(flutter.xcode.open)

" Language Rust
nmap              <leader>lrr  <Action>(Rust.ConsoleREPL)

" Use jk to cycle through panes (counter-)clockwise and JK to swap them.
nnoremap <silent> <C-w>j <C-w>w
nnoremap <silent> <C-w>k <C-w>W
nnoremap <silent> <C-w>J mX<C-w>wmY'X<C-w>W'Y<C-w>w
nnoremap <silent> <C-w>K mX<C-w>WmY'X<C-w>w'Y<C-w>W

" Move current line up and down.
nnoremap <silent> <C-9>  :move .+1<CR>==
nnoremap <silent> <C-0>  :move .-2<CR>==
inoremap <silent> <C-9>  <ESC>:move .+1<CR>==gi
inoremap <silent> <C-0>  <ESC>:move .-2<CR>==gi
xnoremap <silent> <C-9>  :move '>+1<CR>gv=gv
xnoremap <silent> <C-0>  :move '<-2<CR>gv=gv

" Sanity remappings ......................................................{{{1

" Move through wrapped lines.
nnoremap j gj
nnoremap k gk
xnoremap j gj
xnoremap k gk

" Paste and keep clipboard.
xnoremap p pgvy
xnoremap p "_dP

" Start search with 'very magic'.
nnoremap / /\v
nnoremap ? ?\v
"cnoremap %s/ %sm//g<Left><Left>

" Don't exit visual mode on shifting.
xnoremap < <gv
xnoremap > >gv

" Yank till the end of the line.
nnoremap Y y$

" Clear matches.
nnoremap <silent> <C-l> :nohlsearch<CR><C-l>
nnoremap <silent> <ESC> :nohlsearch<CR>

" Same C-m (Enter) as in insert mode.
nnoremap <C-m> o<ESC>

" Same C-j as in Emacs.
nnoremap <C-j> i<CR><ESC>

" Start new change before Ctrl-U and Ctrl-W for undo.
inoremap <C-u> <C-g>u<C-u>
inoremap <C-w> <C-g>u<C-w>

" Respect an already typed prefix when iterating through history.
cnoremap <C-p> <Up>
cnoremap <C-n> <Down>

" Compatibility remappings ...............................................{{{1

" Emacs bindings in insert mode
imap     <C-a>   <Action>(EditorLineStart)
imap     <C-e>   <Action>(EditorLineEnd)
inoremap <C-b>   <Left>
inoremap <C-f>   <Right>
" Make original C-e accessible through S-C-y.
inoremap <S-C-y> <C-e>

" Emacs bindings in command mode
cnoremap <C-b>   <Left>
cnoremap <C-f>   <Right>
cnoremap <C-d>   <DEL>

" Add missing bindings
nmap <C-^>       <S-C-6>
nmap <C-o>       <Action>(Back)
nmap <C-i>       <Action>(Forward)
nmap zr          <Action>(ExpandAllToLevel)

" Remap preferred key to circumflex.
map <C-,> <C-^>
