# General behaviour
set -gw mode-keys vi              # Enable vi keys for copy mode.
set -g mouse off                  # Disable mouse.
set -g repeat-time 750            # Wait time for repeated keys.
set -g renumber-windows on        # Automatically re-number windows when others are closed.
set -g status-interval 1          # Update the status line more frequently.
set -g focus-events on            # Request and forward focus events.
set -s escape-time 10             # Set shorter wait-time after escape key.
set -g default-terminal "screen-256color"        # $TERM in tmux
set -sa terminal-overrides ',xterm-256color:RGB' # $TERM out of tmux
set -g base-index 1
set -g pane-active-border-style fg=magenta

# Notifications
set -gw monitor-activity on
set -gw monitor-bell on
set -gw monitor-silence 10800

# Prefix-highlight settings
set -g @prefix_highlight_fg 'white'
set -g @prefix_highlight_bg 'black'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_show_sync_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=black,bg=brightyellow'
set -g @prefix_highlight_sync_mode_attr 'fg=white,bg=magenta'
set -g @prefix_highlight_prefix_prompt ' ^B '
set -g @prefix_highlight_copy_prompt 'Copy'
set -g @prefix_highlight_sync_prompt 'Sync'
set -g @prefix_highlight_output_prefix ' '
set -g @prefix_highlight_empty_prompt '      '

# Status line
set -g status-position top
set -g status-justify centre
set -g status-style "fg=white,bg=brightblue"
set -g status-left "#{prefix_highlight}"
set -g status-right "%d/%m %a %H:%M:%S "
set -g window-status-activity-style ""
set -g window-status-bell-style ""
set -g window-status-current-format "\
#[fg=black,bg=cyan] \
#I:\
#{?#{&&:#{!=:#{?#W,#W,#{pane_current_command}},#{pane_current_command}},#{!=:#W,[tmux]}},#[bold]#[underscore]#W#[none],\
#(v='#{pane_current_path}'; v=\${v/#\$HOME/'~'#}; echo \$(basename \"\$v\"))}\
|#{pane_current_command}\
#{?window_zoomed_flag, \uf848,} \
#[bg=default] \
"
set -g window-status-format "\
#I:\
#{?#{&&:#{!=:#{?#W,#W,#{pane_current_command}},#{pane_current_command}},#{!=:#W,[tmux]}},#[bold]#[underscore]#W#[none],\
#(v='#{pane_current_path}'; v=\${v/#\$HOME/'~'#}; echo \$(basename \"\$v\"))}\
|#{pane_current_command}\
#{?#{||:#{window_activity_flag},#{window_bell_flag}}, \uf59e,#{?window_silence_flag, \uf9b1,}} \
"

# 2nd status line
set -g status 2
set -g status-format[1] "\
#[align=right,fg=black,bg=brightgreen,fill=brightgreen]\
#(p='#{pane_current_path}'; p=\${p/#\$HOME/'~'}; echo \$p) \
"

# Inherit cwd when creating new panes.
bind c   new-window      -c "#{pane_current_path}"
bind '"' split-window -h -c "#{pane_current_path}"
bind %   split-window -v -c "#{pane_current_path}"

# Use C-hjkl instead of arrows for selecting panes.
bind C-h select-pane -L
bind C-l select-pane -R
bind C-k select-pane -U
bind C-j select-pane -D
bind h   select-pane -L
bind l   select-pane -R
bind k   select-pane -U
bind j   select-pane -D

# Use HJKL instead of M-arrows for resizing panes.
default_pane_resize="2"
bind -r H resize-pane -L "$default_pane_resize"
bind -r L resize-pane -R "$default_pane_resize"
bind -r K resize-pane -U "$default_pane_resize"
bind -r J resize-pane -D "$default_pane_resize"

# Make C-b repeatable.
bind -r C-b send-keys "C-b"

# Create new pane spanning the full window size.
bind | split-window -fh -c "#{pane_current_path}"
bind _ split-window -fv -c "#{pane_current_path}"

# Merge pane into window
bind M command-prompt -p "Merge current pane into [session:]window:" "join-pane -t '%%'"

# Make `copy mode` a bit more vim-like.
bind -T copy-mode-vi v send-keys -X begin-selection # Start selection with v.
bind -T copy-mode-vi _ send-keys -X start-of-line   # Go to beginning of line with _.
bind -T copy-mode-vi y send-keys "Enter"            # Copy and exit with y.
bind -T copy-mode-vi i send-keys "q"                # Leave visual mode with i.

# Open or reload config.
bind C new-window "nvim ~/.tmux.conf"
bind R source-file ~/.tmux.conf \; display-message "~/.tmux.conf reloaded"

# Plugins
set -g @plugin "tmux-plugins/tpm"                   # Plugin manager
set -g @plugin "tmux-plugins/tmux-sensible"         # Sensible defaults
set -g @plugin "tmux-plugins/tmux-prefix-highlight" # Show when prefix was hit

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run "~/.tmux/plugins/tpm/tpm"
